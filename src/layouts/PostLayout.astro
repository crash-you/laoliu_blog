---
interface Props {
  title: string;
  description: string;
  heroImage?: ImageMetadata;
  pubDate: Date;
  updatedDate?: Date;
  category: string;
  tags: string[];
}

import BaseLayout from './BaseLayout.astro';
import FormattedDate from '../components/FormattedDate.astro';
import { ARTICLE_CATEGORIES, PROJECT_CATEGORIES } from '../consts';

const { title, description, heroImage, pubDate, updatedDate, category, tags } = Astro.props;

// æŸ¥æ‰¾åˆ†ç±»ä¿¡æ¯
const allCategories = [...ARTICLE_CATEGORIES, ...PROJECT_CATEGORIES];
const categoryInfo = allCategories.find(c => c.slug === category) || { name: category };
---

<BaseLayout title={`${title} - è€åˆ˜çš„ç”Ÿè´¢ä¹‹é“`} description={description}>
  <article class="article-page">
    <div class="content-container">
      <!-- Article Header -->
      <header class="article-header">
        <div class="article-meta">
          <span class="category-tag">{categoryInfo.name}</span>
          <span class="date">
            <FormattedDate date={pubDate} />
          </span>
          {updatedDate && (
            <span class="updated">
              (æ›´æ–°äº <FormattedDate date={updatedDate} />)
            </span>
          )}
        </div>
        
        <h1 class="article-title">{title}</h1>
        
        <p class="article-description">{description}</p>
        
        {tags.length > 0 && (
          <div class="article-tags">
            {tags.map(tag => (
              <span class="tag">{tag}</span>
            ))}
          </div>
        )}
      </header>
      
      <!-- Hero Image -->
      {heroImage && (
        <div class="hero-image">
          <img src={heroImage.src} alt={title} />
        </div>
      )}
      
      <!-- Article Content -->
      <div class="prose article-content">
        <slot />
      </div>
      
      <!-- Article Footer -->
      <footer class="article-footer">
        <div class="share-section">
          <p>è§‰å¾—æœ‰ç”¨ï¼Ÿåˆ†äº«ç»™æ›´å¤šäººçœ‹åˆ° ğŸ‘‡</p>
          <div class="share-buttons">
            <button class="btn btn-outline" id="copyLink">
              ğŸ“‹ å¤åˆ¶é“¾æ¥
            </button>
          </div>
        </div>
        
        <div class="author-section">
          <div class="author-card">
            <div class="author-avatar">ğŸ‘¤</div>
            <div class="author-info">
              <h4>è€åˆ˜</h4>
              <p>åˆ†äº«äº’è”ç½‘èµšé’±çš„é—¨é“ï¼ŒåŠ©ä½ æ‰¾åˆ°å±äºè‡ªå·±çš„ç”Ÿè´¢ä¹‹é“</p>
            </div>
          </div>
        </div>
      </footer>
    </div>
  </article>
</BaseLayout>

<style>
  .article-page {
    padding: 2rem 0 4rem;
  }
  
  /* Header */
  .article-header {
    margin-bottom: 2rem;
    padding-bottom: 2rem;
    border-bottom: 1px solid var(--border-color);
  }
  
  .article-meta {
    display: flex;
    align-items: center;
    gap: 1rem;
    margin-bottom: 1rem;
    font-size: 0.875rem;
    color: var(--text-muted);
  }
  
  .category-tag {
    display: inline-block;
    padding: 0.25rem 0.75rem;
    background: var(--primary);
    color: var(--text-inverse);
    border-radius: var(--radius-full);
    font-weight: 500;
  }
  
  .article-title {
    font-size: 2.5rem;
    line-height: 1.2;
    margin-bottom: 1rem;
    color: var(--text-primary);
  }
  
  .article-description {
    font-size: 1.125rem;
    color: var(--text-secondary);
    line-height: 1.6;
    margin-bottom: 1.5rem;
  }
  
  .article-tags {
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem;
  }
  
  /* Hero Image */
  .hero-image {
    margin-bottom: 2rem;
    border-radius: var(--radius-lg);
    overflow: hidden;
  }
  
  .hero-image img {
    width: 100%;
    height: auto;
    display: block;
  }
  
  /* Content */
  .article-content {
    margin-bottom: 3rem;
  }
  
  /* Footer */
  .article-footer {
    border-top: 1px solid var(--border-color);
    padding-top: 2rem;
    margin-bottom: 3rem;
  }
  
  .share-section {
    margin-bottom: 2rem;
    text-align: center;
  }
  
  .share-section p {
    margin-bottom: 1rem;
    color: var(--text-secondary);
  }
  
  .share-buttons {
    display: flex;
    justify-content: center;
    gap: 1rem;
  }
  
  .author-section {
    display: flex;
    justify-content: center;
  }
  
  .author-card {
    display: flex;
    align-items: center;
    gap: 1rem;
    padding: 1.5rem;
    background: var(--bg-tertiary);
    border-radius: var(--radius-lg);
    max-width: 400px;
  }
  
  .author-avatar {
    font-size: 3rem;
  }
  
  .author-info h4 {
    margin: 0 0 0.25rem 0;
    color: var(--text-primary);
  }
  
  .author-info p {
    margin: 0;
    font-size: 0.875rem;
    color: var(--text-muted);
  }
  
  /* Comments */
  .comments-section {
    border-top: 1px solid var(--border-color);
    padding-top: 2rem;
  }
  
  .comments-section h3 {
    margin-bottom: 1.5rem;
  }
  
  .comments-placeholder {
    text-align: center;
    padding: 3rem;
    background: var(--bg-tertiary);
    border-radius: var(--radius-lg);
  }
  
  .comments-placeholder p {
    margin: 0;
  }
  
  /* Responsive */
  @media (max-width: 768px) {
    .article-title {
      font-size: 1.75rem;
    }
    
    .article-meta {
      flex-wrap: wrap;
    }
  }
</style>

<script>
  const copyBtn = document.getElementById('copyLink');
  copyBtn?.addEventListener('click', async () => {
    try {
      await navigator.clipboard.writeText(window.location.href);
      copyBtn.textContent = 'âœ… å·²å¤åˆ¶';
      setTimeout(() => {
        copyBtn.textContent = 'ğŸ“‹ å¤åˆ¶é“¾æ¥';
      }, 2000);
    } catch {
      console.error('å¤åˆ¶å¤±è´¥');
    }
  });
</script>
