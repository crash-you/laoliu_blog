---
import BaseLayout from '../layouts/BaseLayout.astro';
---

<BaseLayout 
  title="æœç´¢ - è€åˆ˜çš„ç”Ÿè´¢ä¹‹é“" 
  description="åœ¨è€åˆ˜çš„ç”Ÿè´¢ä¹‹é“ä¸­æœç´¢æ–‡ç« å’Œé¡¹ç›®"
>
  <section class="search-page">
    <div class="content-container">
      <h1>ğŸ” æœç´¢</h1>
      <p class="search-intro">è¾“å…¥å…³é”®è¯ï¼Œæœç´¢å…¨ç«™å†…å®¹</p>
      
      <!-- Pagefind Search UI -->
      <div id="search" class="pagefind-container"></div>
      
      <!-- åŠ è½½æç¤º -->
      <div id="search-loading" class="search-hint">
        <p>æ­£åœ¨åŠ è½½æœç´¢åŠŸèƒ½...</p>
      </div>
    </div>
  </section>
</BaseLayout>

<style>
  .search-page {
    padding: 3rem 0 4rem;
    min-height: 70vh;
  }
  
  h1 {
    text-align: center;
    margin-bottom: 0.5rem;
  }
  
  .search-intro {
    text-align: center;
    color: var(--text-muted);
    margin-bottom: 2rem;
  }
  
  .pagefind-container {
    max-width: 600px;
    margin: 0 auto;
  }
  
  /* Pagefind UI æ ·å¼è¦†ç›– */
  :global(.pagefind-ui) {
    --pagefind-ui-scale: 1;
    --pagefind-ui-primary: var(--primary);
    --pagefind-ui-text: var(--text-primary);
    --pagefind-ui-background: var(--bg-secondary);
    --pagefind-ui-border: var(--border-color);
    --pagefind-ui-tag: var(--bg-tertiary);
    --pagefind-ui-border-width: 2px;
    --pagefind-ui-border-radius: 8px;
    --pagefind-ui-font: var(--font-sans);
  }
  
  :global(.pagefind-ui__search-input) {
    padding: 1rem 1.25rem !important;
    font-size: 1rem !important;
    border-radius: var(--radius) !important;
  }
  
  :global(.pagefind-ui__search-input:focus) {
    border-color: var(--primary) !important;
    box-shadow: 0 0 0 3px rgba(26, 54, 93, 0.1) !important;
  }
  
  :global(.pagefind-ui__result) {
    padding: 1rem !important;
    border-radius: var(--radius) !important;
    margin-bottom: 0.75rem !important;
    background: var(--bg-secondary) !important;
    border: 1px solid var(--border-color) !important;
  }
  
  :global(.pagefind-ui__result:hover) {
    border-color: var(--primary) !important;
  }
  
  :global(.pagefind-ui__result-title) {
    font-weight: 600 !important;
    color: var(--text-primary) !important;
  }
  
  :global(.pagefind-ui__result-link:hover .pagefind-ui__result-title) {
    color: var(--primary) !important;
  }
  
  :global(.pagefind-ui__result-excerpt) {
    color: var(--text-secondary) !important;
  }
  
  :global(mark.pagefind-ui__result-highlight) {
    background: var(--accent) !important;
    color: var(--primary-dark) !important;
    padding: 0 2px !important;
    border-radius: 2px !important;
  }
  
  .search-hint {
    text-align: center;
    color: var(--text-muted);
    padding: 3rem;
    background: var(--bg-tertiary);
    border-radius: var(--radius-lg);
    max-width: 600px;
    margin: 0 auto;
  }
  
  .search-hint.hidden {
    display: none;
  }
  
  .search-hint code {
    background: var(--bg-secondary);
    padding: 0.25rem 0.5rem;
    border-radius: var(--radius-sm);
  }
</style>

<script is:inline>
  // åœ¨é¡µé¢åŠ è½½ååˆå§‹åŒ– Pagefind
  document.addEventListener('DOMContentLoaded', async function() {
    const container = document.getElementById('search');
    const loading = document.getElementById('search-loading');
    
    if (!container) return;
    
    try {
      // åŠ è½½ Pagefind CSS
      const cssLink = document.createElement('link');
      cssLink.rel = 'stylesheet';
      cssLink.href = '/pagefind/pagefind-ui.css';
      document.head.appendChild(cssLink);
      
      // åŠ è½½ Pagefind JS
      const script = document.createElement('script');
      script.src = '/pagefind/pagefind-ui.js';
      script.onload = function() {
        // éšè—åŠ è½½æç¤º
        if (loading) loading.classList.add('hidden');
        
        // åˆå§‹åŒ–æœç´¢ UI
        new PagefindUI({
          element: '#search',
          showImages: false,
          showSubResults: true,
          translations: {
            placeholder: 'æœç´¢æ–‡ç« ã€é¡¹ç›®ã€æ•…äº‹...',
            zero_results: 'æ²¡æœ‰æ‰¾åˆ°ç›¸å…³ç»“æœ',
            many_results: 'æ‰¾åˆ° [COUNT] ä¸ªç»“æœ',
            one_result: 'æ‰¾åˆ° 1 ä¸ªç»“æœ',
            alt_search: 'æ²¡æœ‰æ‰¾åˆ°ç»“æœï¼Œå°è¯•æœç´¢ [TERM]',
            search_suggestion: 'æ²¡æœ‰æ‰¾åˆ°ç»“æœï¼Œå°è¯•ä»¥ä¸‹æœç´¢ï¼š',
            searching: 'æœç´¢ä¸­...',
          },
        });
      };
      script.onerror = function() {
        // æ˜¾ç¤ºæœªæ„å»ºæç¤º
        if (loading) {
          loading.innerHTML = '<p>ğŸ’¡ æœç´¢åŠŸèƒ½åœ¨ç«™ç‚¹æ„å»ºåå¯ç”¨</p><p>è¿è¡Œ <code>npm run build</code> ååˆ·æ–°é¡µé¢</p>';
        }
      };
      document.head.appendChild(script);
    } catch (e) {
      console.error('Pagefind åŠ è½½å¤±è´¥:', e);
      if (loading) {
        loading.innerHTML = '<p>âš ï¸ æœç´¢åŠŸèƒ½åŠ è½½å¤±è´¥</p>';
      }
    }
  });
</script>
